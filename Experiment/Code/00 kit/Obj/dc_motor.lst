C51 COMPILER V9.02   DC_MOTOR                                                              12/16/2022 23:19:35 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE DC_MOTOR
OBJECT MODULE PLACED IN ..\Obj\dc_motor.obj
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE ..\Api\dc_motor.c BROWSE INCDIR(..\Api;..\Public;..\User) DEBUG OBJECTEXTEN
                    -D PRINT(..\Obj\dc_motor.lst) OBJECT(..\Obj\dc_motor.obj)

line level    source

   1          #include "dc_motor.h"
   2          
   3          xdata unsigned char g_motor_tim_scale, g_motor_duty;
   4          /*******************************
   5          函数名：DC_Motor_init
   6          函数功能：DC_Motor初始化
   7          函数形参：u8 tim_H, u8 tim_L, u8 tim_scale, u8 duty
   8          函数返回值：void 
   9          备注：计数器的记一次的时间（tim_H,tim_L决定） * tim_sclae = 周期，duty占空比，取值0~tim_scale
  10                    占用计时器0   P1^0端口
  11          *******************************/
  12          void DC_Motor_init(unsigned char tim_H, unsigned char tim_L, unsigned char tim_scale, unsigned char duty) 
             - //11.0592MHz
  13          {
  14   1              g_motor_tim_scale = tim_scale;
  15   1              g_motor_duty = duty;
  16   1      
  17   1              #if USE_DC_MOTOR_TIMER2
                      RCLK = 0;
                      TCLK = 0;
                      CP_RL2 = 0;  // 计数器2工作在16位重装载模式
                      TR2 = 1;  // 计数器2工作
                      RCAP2H = TH2 = tim_H;  // 0xff 
                      RCAP2L = TL2 = tim_L;  // 0xf6 -> 0.01ms
                      EA = 1;
                      ET2 = 1;  // 打开中断
                      #endif
  27   1      }
*** WARNING C280 IN LINE 12 OF ..\API\DC_MOTOR.C: 'tim_H': unreferenced local variable
*** WARNING C280 IN LINE 12 OF ..\API\DC_MOTOR.C: 'tim_L': unreferenced local variable
  28          
  29          /*******************************
  30          函数名：DC_Motor_duty
  31          函数功能：DC_Motor改变占空比
  32          函数形参：u8 duty
  33          函数返回值：void 
  34          备注：
  35          *******************************/
  36          void DC_Motor_duty(unsigned char duty)
  37          {
  38   1              g_motor_duty = duty;
  39   1      }
  40          
  41          /*******************************
  42          函数名：DC_Motor_interrupt
  43          函数功能：DC_Motor中断服务函数
  44          函数形参：void
  45          函数返回值：void 
  46          备注：定时器0的中断
  47          *******************************/
  48          #if     USE_DC_MOTOR_TIMER2_INT
              void DC_Motor_interrupt() interrupt 5
              {
                      static unsigned char cnt=0;
C51 COMPILER V9.02   DC_MOTOR                                                              12/16/2022 23:19:35 PAGE 2   

                      
                      cnt++;
                      if (cnt >= g_motor_tim_scale) cnt = 0;  // 周期到了
                      if (cnt <= g_motor_duty) DC_Motor = 1;
                      else DC_Motor = 0;
              }
              #endif
  59          
  60          /*******************************
  61          函数名：DC_Motor_Run
  62          函数功能：控制直流电机速度，按键扫描，1：加速，2：减速
  63          函数形参：u8 tim_scale
  64          函数返回值：void 
  65          备注：motor为P1^0，占空比阈值，最小值等于0，最大值等于tim_scale
  66          *******************************/
  67          void DC_Motor_Run(unsigned char tim_scale)
  68          {
  69   1              unsigned char key=-1;
  70   1              static char duty=0;
  71   1      
  72   1              key = matrix_key_scan();
  73   1              if (key==1)
  74   1              {
  75   2                      duty += 10;
  76   2                      if (duty>=tim_scale) duty = tim_scale;
  77   2              } else if (key==2)
  78   1              {
  79   2                      duty -= 10;
  80   2                      if (duty<=0) duty = 0;
  81   2              }       
  82   1              DC_Motor_duty(duty);
  83   1              delay_ms(1);
  84   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     92    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
