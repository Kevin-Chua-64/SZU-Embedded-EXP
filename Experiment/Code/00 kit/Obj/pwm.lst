C51 COMPILER V9.02   PWM                                                                   12/16/2022 23:19:34 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE PWM
OBJECT MODULE PLACED IN ..\Obj\pwm.obj
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE ..\Api\pwm.c BROWSE INCDIR(..\Api;..\Public;..\User) DEBUG OBJECTEXTEND PRI
                    -NT(..\Obj\pwm.lst) OBJECT(..\Obj\pwm.obj)

line level    source

   1          #include "pwm.h"
   2          
   3          xdata unsigned char g_pwm_tim_scale, g_pwm_duty;
   4          /*******************************
   5          函数名：pwm_init
   6          函数功能：pwm初始化
   7          函数形参：u8 tim_H, u8 tim_L, u8 tim_scale, u8 duty
   8          函数返回值：void 
   9          备注：计数器的记一次的时间（tim_H,tim_L决定） * tim_sclae = 周期，duty占空比，取值0~tim_scale
  10                    占用计时器2
  11          *******************************/
  12          void pwm_init(unsigned char tim_H, unsigned char tim_L, unsigned char tim_scale, unsigned char duty)  //11
             -.0592MHz
  13          {
  14   1              g_pwm_tim_scale = tim_scale;
  15   1              g_pwm_duty = duty;
  16   1      
  17   1              #if USE_PWM_TIMER2
                      RCLK = 0;
                      TCLK = 0;
                      CP_RL2 = 0;  // 计数器2工作在16位重装载模式
                      TR2 = 1;  // 计数器2工作
                      RCAP2H = TH2 = tim_H;  // 0xff 
                      RCAP2L = TL2 = tim_L;  // 0xf6 -> 0.01ms
                      EA = 1;
                      ET2 = 1;  // 打开中断
                      #endif
  27   1      }
*** WARNING C280 IN LINE 12 OF ..\API\PWM.C: 'tim_H': unreferenced local variable
*** WARNING C280 IN LINE 12 OF ..\API\PWM.C: 'tim_L': unreferenced local variable
  28          
  29          /*******************************
  30          函数名：pwm_duty
  31          函数功能：pwm改变占空比
  32          函数形参：u8 duty
  33          函数返回值：void 
  34          备注：
  35          *******************************/
  36          void pwm_duty(unsigned char duty)
  37          {
  38   1              g_pwm_duty = duty;
  39   1      }
  40          
  41          /*******************************
  42          函数名：pwm_interrupt
  43          函数功能：pwm中断服务函数
  44          函数形参：void
  45          函数返回值：void 
  46          备注：定时器2的中断
  47          *******************************/
  48          #if     USE_PWM_TIMER2_INT
              void pwm_interrupt() interrupt 5
              {
                      static unsigned char cnt=0;
C51 COMPILER V9.02   PWM                                                                   12/16/2022 23:19:34 PAGE 2   

                      
                      cnt++;
                      if (cnt >= g_pwm_tim_scale) cnt = 0;  // 周期到了
                      if (cnt <= g_pwm_duty) PWM = 1;
                      else PWM = 0;
              }
              #endif
  59          
  60          /*******************************
  61          函数名：pwm_led2
  62          函数功能：pwm控制led2呼吸灯
  63          函数形参：u8 duty_max, u8 char duty_min
  64          函数返回值：void 
  65          备注：led为P2^1，占空比的阈值（最小值等于零，最大值等于tim_scale）
  66          *******************************/
  67          void pwm_led2(unsigned char duty_max, unsigned char duty_min)
  68          {
  69   1              static bit dic=0;
  70   1              static char duty=0;
  71   1      
  72   1              if (dic==0)
  73   1              {
  74   2                      duty++;
  75   2                      if (duty>=duty_max) dic = 1;
  76   2              } else if (dic==1)
  77   1              {
  78   2                      duty--;
  79   2                      if (duty<=duty_min) dic = 0;
  80   2              }       
  81   1              pwm_duty(duty);
  82   1              delay_ms(1);
  83   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     84    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
